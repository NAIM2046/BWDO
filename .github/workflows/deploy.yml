name: Deploy Next.js to VPS

# যখন main ব্রাঞ্চে কোড পুশ করা হবে, তখন এটি রান করবে
on:
  push:
    branches:
      - main # আপনার মেইন ব্রাঞ্চের নাম যদি 'master' হয়, তবে এখানে 'master' লিখে দেবেন

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Deploy to VPS via SSH
        uses: appleboy/ssh-action@v1.0.0
        with:
          host: ${{ secrets.VPS_IP }}
          username: ${{ secrets.VPS_USERNAME }}
          password: ${{ secrets.VPS_PASSWORD }}
          port: 22
          script: |
            # সার্ভারে আপনার প্রজেক্টের ফোল্ডারে ঢুকবে
            cd /var/www/bwdo

            # গিটহাব থেকে নতুন কোড নামাবে
            git pull origin main

            # নতুন কোনো প্যাকেজ থাকলে ইন্সটল করবে
            npm install

            # প্রোডাকশন বিল্ড তৈরি করবে
            npm run build

            # সার্ভার রিস্টার্ট করবে
            pm2 restart bwdo
